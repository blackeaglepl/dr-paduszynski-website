---
import type { ImageMetadata } from 'astro';

export interface Props {
  title?: string;
  description?: string;
  heroImage?: ImageMetadata;
  pubDate?: Date;
  updatedDate?: Date;
  category?: 'porady' | 'aktualnosci';
  tags?: string[];
  author?: string;
  readingTime?: number;
  keywords?: string;
  canonical?: string;
}

import { Image } from 'astro:assets';
import { SITE_AUTHOR } from '../consts';
import MainLayout from './MainLayout.astro';
import HeroSection from '../components/HeroSection.astro';
import FormattedDate from '../components/FormattedDate.astro';
import SchemaMarkup from '../components/SchemaMarkup.astro';
import PreFooterLogoSection from '../components/PreFooterLogoSection.astro';

const { 
  title = 'Artykuł', 
  description = '', 
  heroImage,
  pubDate,
  updatedDate,
  category = 'porady',
  tags = [],
  author = SITE_AUTHOR,
  readingTime,
  keywords = 'osteopatia, fizjoterapia, zdrowie kręgosłupa, terapia manualna',
  canonical = Astro.url.href
}: Props = Astro.props;

// Mapowanie kategorii
const categoryConfig: Record<'porady' | 'aktualnosci', { color: string; label: string }> = {
  'porady': { color: 'medical-primary', label: 'Porady' },
  'aktualnosci': { color: 'medical-light', label: 'Aktualności' }
};

const categoryInfo = categoryConfig[category] || categoryConfig['porady'];
---

<MainLayout 
  title={`${title} – Blog o Osteopatii`} 
  description={description}
  image={heroImage?.src}
  keywords={keywords}
  author={author}
  canonical={canonical}
  type="article"
  hideHeader={true}
  schemaType="blog"
>
  <!-- Hero Section -->
  <HeroSection
    title={title}
    supportingText={description}
    ratingStars={0}
    bgImageSrc={heroImage?.src}
    extraBottomGradient={true}
  />

  <!-- Spacer po usunięciu paska meta (zachowanie odstępu) -->
  <div aria-hidden="true" class="py-8"></div>

  <!-- Meta: czas czytania -->
  {readingTime && (
    <div class="container mx-auto px-4 md:px-6 max-w-3xl mb-6">
      <div class="flex items-center gap-2 text-medical-text-light text-small-mobile md:text-body-desktop">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>{readingTime} min czytania</span>
      </div>
    </div>
  )}

  <!-- Article Content -->
  <article class="py-0 md:py-8">
    <div class="container mx-auto px-4 md:px-6 max-w-3xl">
      <div class="prose prose-lg prose-medical max-w-none">
        <slot />
      </div>

      <!-- Tags -->
      {tags && tags.length > 0 && (
        <div class="mt-12 pt-8 border-t border-medical-bg">
          <h3 class="text-h3-mobile font-heading font-semibold text-medical-text mb-4">Tagi</h3>
          <div class="flex flex-wrap gap-2">
            {tags.map((tag) => (
              <span class="px-3 py-1 bg-medical-bg text-medical-text text-small-mobile rounded-md hover:bg-medical-primary hover:text-white transition-colors duration-200 cursor-pointer">
                #{tag}
              </span>
            ))}
          </div>
        </div>
      )}

      <!-- Updated Date -->
      {updatedDate && (
        <div class="mt-8 pt-8 border-t border-medical-bg">
          <p class="text-small-mobile text-medical-text-light">
            Ostatnia aktualizacja: <FormattedDate date={updatedDate} />
          </p>
        </div>
      )}
    </div>
  </article>

  <!-- Back to Blog CTA -->
  <section class="py-16 bg-medical-bg">
    <div class="container mx-auto px-4 md:px-6 max-w-4xl text-center">
      <h3 class="text-h3-mobile md:text-h3-desktop font-heading font-semibold text-medical-text mb-4">
        Przeglądaj więcej artykułów
      </h3>
      <p class="text-body-mobile md:text-body-desktop text-medical-text-light mb-8">
        Dowiedz się więcej o osteopatii, fizjoterapii i zdrowiu kręgosłupa
      </p>
      <a 
        href="/blog/" 
        class="inline-flex items-center gap-2 bg-medical-primary hover:bg-medical-light text-white font-heading font-semibold py-3 px-6 rounded-lg transition-colors duration-200 focus:ring-2 focus:ring-medical-primary/50 focus:outline-none shadow-sm"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        Zobacz wszystkie artykuły
      </a>
    </div>
  </section>
  
  <!-- Pre-Footer Logo Section -->
  <PreFooterLogoSection />
  <!-- Schema Markup dla Artykułu -->
  <SchemaMarkup 
    schemaType="custom" 
    customSchema={{
      article: {
        "@type": "Article",
        "headline": title,
        "description": description,
        "author": {
          "@type": "Person",
          "name": author
        },
        "publisher": {
          "@type": "Organization", 
          "name": "Gabinet Osteopatii Dr Jarema Paduszyński"
        },
        "datePublished": pubDate?.toISOString(),
        "dateModified": (updatedDate || pubDate)?.toISOString(),
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": canonical
        },
        "image": heroImage?.src,
        "articleSection": categoryInfo.label,
        "keywords": keywords
      }
    }}
  />
</MainLayout>