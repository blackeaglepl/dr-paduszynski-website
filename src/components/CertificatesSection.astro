---
/* @ts-nocheck */
// Sekcja: Certyfikaty i referencje (karuzela A4)
// Reużywa logiki z ClinicGallerySection: strzałki, auto-scroll, klawiatura
import diploma1 from '../assets/dyplom1.jpg';
import diploma2 from '../assets/dyplom2.jpg';
import diploma3 from '../assets/dyplom3.jpg';
import diploma4 from '../assets/dyplom4.jpg';
import diploma5 from '../assets/dyplom5.jpg';
import diploma6 from '../assets/dyplom6.jpg';
import arrow from '../assets/arrow.svg';
import { getLocaleFromUrl, getTranslations, type Locale } from "../utils/i18n";

const currentLocale = getLocaleFromUrl(Astro.url) as Locale;
const t = getTranslations(currentLocale);

// Tłumaczenia certyfikatów
const translations = {
  pl: {
    heading: { strong: 'Certyfikaty', light: 'i referencje' },
    navigation: {
      previous: 'Poprzednie certyfikaty',
      next: 'Następne certyfikaty', 
      prevAlt: 'Poprzednie',
      nextAlt: 'Następne'
    },
    certificates: [
      'Dyplom ukończenia studiów magisterskich – fizjoterapia',
      'Certyfikat ukończenia kursu osteopatii',
      'Certyfikat specjalizacji w terapii manualnej',
      'Dyplom doktora nauk medycznych',
      'Certyfikat ukończenia kursu terapii czaszkowo-krzyżowej',
      'Certyfikat członkostwa w Polskim Towarzystwie Osteopatii'
    ]
  },
  en: {
    heading: { strong: 'Certificates', light: 'and references' },
    navigation: {
      previous: 'Previous certificates',
      next: 'Next certificates',
      prevAlt: 'Previous', 
      nextAlt: 'Next'
    },
    certificates: [
      'Master\'s degree diploma – physiotherapy',
      'Osteopathy course completion certificate',
      'Manual therapy specialization certificate',
      'PhD in medical sciences diploma',
      'Craniosacral therapy course completion certificate',
      'Polish Society of Physiotherapy membership certificate'
    ]
  }
} as const;

const content = translations[currentLocale];
---

<section id="certyfikaty" class="py-16 md:pt-20 lg:pt-24 pb-16">
  <div class="container mx-auto px-4 md:px-6 max-w-6xl">
    <!-- Nagłówek sekcji -->
    <h2
      class="font-heading transition-colors duration-150 hover:text-medical-primary text-h2-mobile md:text-h2-desktop text-medical-text tracking-tight text-center mb-2 md:mb-3"
      data-animate="fade-up"
      data-animate-delay="100"
    >
      <strong class="font-semibold">{content.heading.strong}</strong> {content.heading.light}
    </h2>

    <!-- Karuzela dyplomów (format A4) -->
    <div
      id="certificates-carousel"
      class="relative mt-2 md:mt-3 pt-3 md:pt-4 select-none"
      aria-roledescription="carousel"
      tabindex="0"
      data-animate="fade-up"
      data-animate-delay="100"
    >
      <!-- Przyciski nawigacji -->
      <button
        type="button"
        aria-label={content.navigation.previous}
        data-action="prev"
        class="hidden md:flex items-center justify-center absolute -left-10 lg:-left-14 top-1/2 -translate-y-1/2 h-10 w-10 rounded-full bg-white/80 text-medical-text shadow-sm ring-1 ring-medical-bg hover:bg-white focus:outline-none focus:ring-2 focus:ring-medical-primary/50"
      >
        <img src={arrow.src} alt={content.navigation.prevAlt} aria-hidden="true" class="h-5 w-5 md:h-6 md:w-6 rotate-180" />
      </button>
      <button
        type="button"
        aria-label={content.navigation.next}
        data-action="next"
        class="hidden md:flex items-center justify-center absolute -right-10 lg:-right-14 top-1/2 -translate-y-1/2 h-10 w-10 rounded-full bg-white/80 text-medical-text shadow-sm ring-1 ring-medical-bg hover:bg-white focus:outline-none focus:ring-2 focus:ring-medical-primary/50"
      >
        <img src={arrow.src} alt={content.navigation.nextAlt} aria-hidden="true" class="h-5 w-5 md:h-6 md:w-6" />
      </button>

      <!-- Okno widoku: ukryj tylko nadmiar w osi X, zostaw miejsce na cień w Y + wewnętrzne paddingi -->
      <div class="overflow-x-hidden overflow-y-visible px-0 pt-6 md:pt-8 pb-12 md:pb-16">
        <!-- Tor slajdów -->
        <div class="flex transition-transform duration-500 ease-out will-change-transform" data-carousel-track>
          <!-- Slajd 1: Dyplomy 1-3 -->
          <div class="w-full shrink-0 flex-none">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 md:gap-12 items-start justify-items-center px-6 sm:px-8 md:px-14">
              <figure tabindex="0" class="group w-full max-w-[260px] sm:max-w-[300px] md:max-w-[340px] mx-auto my-4 md:my-6">
                <div class="relative w-full pt-[141.4%] bg-white rounded-[30px] shadow-[12px_12px_35px_rgba(0,0,0,0.15)] ring-1 ring-medical-bg transform-gpu transition-all duration-[400ms] ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform md:group-hover:scale-[1.125] md:group-focus:scale-[1.05] md:group-focus-within:scale-[1.125] md:group-hover:z-10">
                  <div class="absolute inset-0 m-auto h-[90%] w-[88%] bg-white rounded-[26px] pt-8 px-3 pb-3 sm:pt-8 sm:px-4 sm:pb-4">
                    <img
                      src={diploma1.src}
                      alt={content.certificates[0]}
                      loading="lazy"
                      class="h-full w-full object-contain rounded-[16px]"
                    />
                  </div>
                </div>
              </figure>
              <figure tabindex="0" class="group w-full max-w-[260px] sm:max-w-[300px] md:max-w-[340px] mx-auto my-4 md:my-6">
                <div class="relative w-full pt-[141.4%] bg-white rounded-[30px] shadow-[12px_12px_35px_rgba(0,0,0,0.15)] ring-1 ring-medical-bg transform-gpu transition-all duration-[400ms] ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform md:group-hover:scale-[1.125] md:group-focus:scale-[1.05] md:group-focus-within:scale-[1.125] md:group-hover:z-10">
                  <div class="absolute inset-0 m-auto h-[90%] w-[88%] bg-white rounded-[26px] pt-8 px-3 pb-3 sm:pt-8 sm:px-4 sm:pb-4">
                    <img
                      src={diploma2.src}
                      alt={content.certificates[1]}
                      loading="lazy"
                      class="h-full w-full object-contain rounded-[16px]"
                    />
                  </div>
                </div>
              </figure>
              <figure tabindex="0" class="group w-full max-w-[260px] sm:max-w-[300px] md:max-w-[340px] mx-auto my-4 md:my-6">
                <div class="relative w-full pt-[141.4%] bg-white rounded-[30px] shadow-[12px_12px_35px_rgba(0,0,0,0.15)] ring-1 ring-medical-bg transform-gpu transition-all duration-[400ms] ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform md:group-hover:scale-[1.125] md:group-focus:scale-[1.05] md:group-focus-within:scale-[1.125] md:group-hover:z-10">
                  <div class="absolute inset-0 m-auto h-[90%] w-[88%] bg-white rounded-[26px] pt-8 px-3 pb-3 sm:pt-8 sm:px-4 sm:pb-4">
                    <img
                      src={diploma3.src}
                      alt={content.certificates[2]}
                      loading="lazy"
                      class="h-full w-full object-contain rounded-[16px]"
                    />
                  </div>
                </div>
              </figure>
            </div>
          </div>

          <!-- Slajd 2: Dyplomy 4-6 -->
          <div class="w-full shrink-0 flex-none">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 md:gap-12 items-start justify-items-center px-6 sm:px-8 md:px-14">
              <figure tabindex="0" class="group w-full max-w-[260px] sm:max-w-[300px] md:max-w-[340px] mx-auto my-4 md:my-6">
                <div class="relative w-full pt-[141.4%] bg-white rounded-[30px] shadow-[12px_12px_35px_rgba(0,0,0,0.15)] ring-1 ring-medical-bg transform-gpu transition-all duration-[400ms] ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform md:group-hover:scale-[1.125] md:group-focus:scale-[1.05] md:group-focus-within:scale-[1.125] md:group-hover:z-10">
                  <div class="absolute inset-0 m-auto h-[90%] w-[88%] bg-white rounded-[26px] pt-8 px-3 pb-3 sm:pt-8 sm:px-4 sm:pb-4">
                    <img
                      src={diploma4.src}
                      alt={content.certificates[3]}
                      loading="lazy"
                      class="h-full w-full object-contain rounded-[16px]"
                    />
                  </div>
                </div>
              </figure>
              <figure tabindex="0" class="group w-full max-w-[260px] sm:max-w-[300px] md:max-w-[340px] mx-auto my-4 md:my-6">
                <div class="relative w-full pt-[141.4%] bg-white rounded-[30px] shadow-[12px_12px_35px_rgba(0,0,0,0.15)] ring-1 ring-medical-bg transform-gpu transition-all duration-[400ms] ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform md:group-hover:scale-[1.125] md:group-focus:scale-[1.05] md:group-focus-within:scale-[1.125] md:group-hover:z-10">
                  <div class="absolute inset-0 m-auto h-[90%] w-[88%] bg-white rounded-[26px] pt-8 px-3 pb-3 sm:pt-8 sm:px-4 sm:pb-4">
                    <img
                      src={diploma5.src}
                      alt={content.certificates[4]}
                      loading="lazy"
                      class="h-full w-full object-contain rounded-[16px]"
                    />
                  </div>
                </div>
              </figure>
              <figure tabindex="0" class="group w-full max-w-[260px] sm:max-w-[300px] md:max-w-[340px] mx-auto my-4 md:my-6">
                <div class="relative w-full pt-[141.4%] bg-white rounded-[30px] shadow-[12px_12px_35px_rgba(0,0,0,0.15)] ring-1 ring-medical-bg transform-gpu transition-all duration-[400ms] ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform md:group-hover:scale-[1.125] md:group-focus:scale-[1.05] md:group-focus-within:scale-[1.125] md:group-hover:z-10">
                  <div class="absolute inset-0 m-auto h-[90%] w-[88%] bg-white rounded-[26px] pt-8 px-3 pb-3 sm:pt-8 sm:px-4 sm:pb-4">
                    <img
                      src={diploma6.src}
                      alt={content.certificates[5]}
                      loading="lazy"
                      class="h-full w-full object-contain rounded-[16px]"
                    />
                  </div>
                </div>
              </figure>
            </div>
          </div>

          <!-- Usuniemy trzeci slajd, pozostawimy 2 slajdy z 6 dyplomami -->
        </div>
      </div>
    </div>

    <!-- Krótka notka uwiarygadniająca -->
    <p class="mt-4 pb-8 text-center text-medical-text-light text-small-mobile md:text-small-desktop" data-animate="fade-up" data-animate-delay="150">
      {currentLocale === 'pl' ? 'Powyżej znajdują się wybrane szkolenia i certyfikaty. Oryginały dostępne do wglądu w moim gabinecie.' : 'Above are selected training courses and certificates. Originals available for inspection in my office.'}
    </p>
  </div>

  <!-- Skrypt karuzeli: auto-scroll, przyciski, pauza po najechaniu -->
  <script>
    const carouselRoot = document.getElementById('certificates-carousel') as HTMLElement | null;
    if (carouselRoot) {
      const track = carouselRoot.querySelector<HTMLElement>('[data-carousel-track]');
      const prevBtn = carouselRoot.querySelector<HTMLButtonElement>('[data-action="prev"]');
      const nextBtn = carouselRoot.querySelector<HTMLButtonElement>('[data-action="next"]');
      const totalSlides: number = track?.children?.length ?? 0;

      let currentIndex = 0;
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let autoScrollId: number = 0;

      const update = (instant: boolean = false) => {
        if (!track) return;
        track.style.transitionDuration = instant || prefersReducedMotion ? '0ms' : '500ms';
        // Dodatkowy padding kompensowany w widoku – przesuwamy pełne szerokości slajdów
        track.style.transform = `translateX(-${currentIndex * 100}%)`;
      };

      const goTo = (nextIndex: number) => {
        currentIndex = (nextIndex + totalSlides) % totalSlides;
        update();
      };

      const start = () => {
        if (prefersReducedMotion) return;
        stop();
        autoScrollId = window.setInterval(() => goTo(currentIndex + 1), 6000) as unknown as number;
      };

      const stop = () => {
        if (autoScrollId) {
          window.clearInterval(autoScrollId);
          autoScrollId = 0;
        }
      };

      // Zdarzenia: klik
      prevBtn?.addEventListener('click', () => goTo(currentIndex - 1));
      nextBtn?.addEventListener('click', () => goTo(currentIndex + 1));

      carouselRoot.addEventListener('mouseenter', stop);
      carouselRoot.addEventListener('mouseleave', start);

      // Dostępność: strzałki z klawiatury przy focusie na sekcji
      carouselRoot.addEventListener('keydown', (e: KeyboardEvent) => {
        if (e.key === 'ArrowLeft') goTo(currentIndex - 1);
        if (e.key === 'ArrowRight') goTo(currentIndex + 1);
      });

      // Obsługa swipe/touch (ulepszona wersja)
      let startX = 0;
      let startY = 0;
      let endX = 0;
      let isDragging = false;
      let startTime = 0;
      let swipeDirection: 'horizontal' | 'vertical' | null = null;

      const handleTouchStart = (e: TouchEvent) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        startTime = Date.now();
        isDragging = true;
        swipeDirection = null;
        stop(); // Zatrzymaj auto-scroll podczas interakcji
      };

      const handleTouchMove = (e: TouchEvent) => {
        if (!isDragging) return;

        const currentX = e.touches[0].clientX;
        const currentY = e.touches[0].clientY;

        if (swipeDirection === null) {
          const deltaX = Math.abs(currentX - startX);
          const deltaY = Math.abs(currentY - startY);
          // Ustaw kierunek tylko jeśli ruch jest wystarczająco duży
          if (deltaX > 5 || deltaY > 5) {
            if (deltaX > deltaY) {
              swipeDirection = 'horizontal';
            } else {
              swipeDirection = 'vertical';
            }
          }
        }

        if (swipeDirection === 'horizontal') {
          endX = e.touches[0].clientX;
          // Zapobiegnij scroll strony podczas swipe karuzeli
          e.preventDefault();
        }
      };

      const handleTouchEnd = () => {
        if (!isDragging) return;
        isDragging = false;
        
        if (swipeDirection === 'horizontal') {
            const deltaX = startX - endX;
            const deltaTime = Date.now() - startTime;
            const minSwipeDistance = 50;
            const maxSwipeTime = 500;

            // Sprawdź czy gest spełnia warunki swipe
            if (Math.abs(deltaX) > minSwipeDistance && deltaTime < maxSwipeTime) {
              if (deltaX > 0) {
                // Swipe w lewo - następny slajd
                goTo(currentIndex + 1);
              } else {
                // Swipe w prawo - poprzedni slajd
                goTo(currentIndex - 1);
              }
            }
        }
        
        // Wznów auto-scroll po krótkiej przerwie
        setTimeout(start, 1000);
      };

      // Zdarzenia touch dla urządzeń mobilnych
      if (track) {
        track.addEventListener("touchstart", handleTouchStart, { passive: false });
        track.addEventListener("touchmove", handleTouchMove, { passive: false });
        track.addEventListener("touchend", handleTouchEnd);
      }

      // Inicjalizacja
      update(true);
      start();
    }
  </script>
</section>


